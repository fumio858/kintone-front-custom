(()=>{var e={56:()=>{const e="case_id",t="case_id",n="title",o="due_date",a="assignee",r="task_status",s="taskPanel",c="case_type",i={22:"åˆ‘äº‹äº‹ä»¶",26:"äº¤é€šäº‹æ•…",55:"åˆ‘äº‹äº¤é€šä»¥å¤–"};!function(){"use strict";const l=e=>kintone.api.url(e.endsWith(".json")?e:`${e}.json`,!0),d=(e="")=>String(e).replace(/\\/g,"\\\\").replace(/"/g,'\\"');kintone.events.on(["app.record.detail.show"],async e=>{const t=kintone.app.record.getSpaceElement(s);if(!t)return e;if(!t.dataset.initedTaskPanel){t.dataset.initedTaskPanel="1";try{await window.userTaskPanelInit(t)}catch(e){console.warn("[task] auto init failed:",e)}}return e}),window.userTaskPanelInit=async function(u){const p=kintone.app.record.get(),m=p&&p.record?p.record:{};kintone.app.getId(),p&&p.record&&p.recordId||kintone.app.record.getId(),await async function(u,p){try{if(!(u=function(e){if(e&&1===e.nodeType)return e;const t=document.querySelector('[data-mirror-of="user-js-taskPanel"]');if(t)return t;const n=kintone.app.record.getSpaceElement(s);if(n)return n;const o=document.querySelector(".ocean-ui-comments-commentform-form");if(o){const e=document.createElement("div");return e.dataset.mirrorOf="user-js-taskPanel",Object.assign(e.style,{marginTop:"12px",borderTop:"1px dashed #e5e7eb",paddingTop:"12px"}),o.insertAdjacentElement("afterend",e),e}const a=document.querySelector("#record-gaia, .contents-gaia, body"),r=document.createElement("div");return r.dataset.mirrorOf="user-js-taskPanel",a.appendChild(r),r}(u)))return console.warn("[task] mountEl not found");u.style.display="",u.innerHTML="";const m=document.createElement("div");m.classList.add("k-task-panel"),m.style.padding="12px",m.style.background="#E9F1F8",m.style.display="",m.innerHTML='\n        <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">\n          <strong>ã‚¿ã‚¹ã‚¯è¿½åŠ </strong>\n          <div style="margin-left:auto; display:flex; gap:6px;">\n            <button id="task-show-list" type="button">ã‚¿ã‚¹ã‚¯ä¸€è¦§</button>\n            <button id="task-close" type="button" aria-label="é–‰ã˜ã‚‹ï¼ˆEscï¼‰">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n          </div>\n        </div>\n        <style>\n          button{ font-size:13px; }\n          .k-task-panel input, .k-task-panel textarea, .k-task-panel select {\n            border: 1px solid #e3e7e8; border-radius: 6px;\n          }\n          .k-task-panel input:focus, .k-task-panel textarea:focus, .k-task-panel select:focus, .k-task-panel button:focus {\n            outline: none; box-shadow: 0 0 0 3px rgba(227,231,232,.4); border-color: #e3e7e8;\n          }\n          #task-show-list, #task-close { border: 1px solid #e3e7e8; background:#fff; padding: 6px 10px; border-radius: 6px; font-size: 12px; }\n          #task-show-list:hover, #task-close:hover { background: #f5f7f8; }\n          .task-add-row{ display:grid; grid-template-columns: 1fr 260px; gap:12px; align-items:stretch; margin-top:8px; }\n          .task-add-left textarea{ width:100%; height:100%; min-height:120px; resize:vertical; padding:10px; box-sizing:border-box; }\n          .task-add-right{ display:flex; flex-direction:column; gap:8px; }\n          .task-add-right > *{ width:100%; box-sizing:border-box; }\n          .task-add-right button{ height:36px; background:#3598db; color:#fff; border-radius: 6px;font-size: .9rem; border: none;}\n          .task-add-right button:hover{ background:#1182ce;}\n          @media (max-width: 640px){ .task-add-row{ grid-template-columns: 1fr; } }\n          .k-task-panel .task-add-right .task-owner, .k-task-panel .task-add-right .task-due{ padding:8px 4px; min-height:36px; box-sizing:border-box; }\n        </style>\n\n        <div id="task-list" style="display:none; flex-direction:column; gap:6px; margin-bottom:12px;"></div>\n        <div class="task-add-row">\n          <div class="task-add-left">\n            <textarea id="task-title" placeholder="ä»¶åã‚’å…¥åŠ›" rows="4"></textarea>\n          </div>\n          <div class="task-add-right">\n            <select id="task-owner" class="task-owner">\n              <option value="" disabled selected>æ‹…å½“è€…ã‚’é¸æŠ</option>\n            </select>\n            <input id="task-due" type="date" class="task-due">\n            <button id="task-add" type="button">ï¼‹ ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>\n          </div>\n        </div>\n        ',u.appendChild(m);const f=m.querySelector("#task-list"),h=m.querySelector("#task-owner"),y=function(){try{const e=kintone.app.getId();if(e)return Number(e)}catch(e){}const e=location.pathname.match(/\/k\/(\d+)\//);return e?Number(e[1]):NaN}(),k=i[y]||"",g=(p?.[e]?.value||"").trim();async function v(){if(!g)return[];const e=d(g),n=k?` and ${c} = "${d(k)}"`:"",a=`${t} = "${e}"${n} order by ${o} asc`;try{const e=await kintone.api(l("/k/v1/records.json"),"GET",{app:23,query:a});if(0===(e.records||[]).length&&/^[0-9]+$/.test(g)){const e=`${t} = ${g}${n} order by ${o} asc`;return(await kintone.api(l("/k/v1/records.json"),"GET",{app:23,query:e})).records||[]}return e.records||[]}catch(e){return console.error("[task] ã‚¿ã‚¹ã‚¯å–å¾—ã‚¨ãƒ©ãƒ¼",e),f.innerHTML=`<div style="color:#c00;">ã‚¿ã‚¹ã‚¯å–å¾—ã§ã‚¨ãƒ©ãƒ¼ï¼š${e?.message||JSON.stringify(e)}</div>`,[]}}function b(e){const t=e.$id.value,s=e[n]?.value||"(ç„¡é¡Œ)",c=e[o]?.value||"",i=e[r]?.value||"",d=Array.isArray(e[a]?.value)?e[a].value.map(e=>e.name||e.code).join(", "):"",u=document.createElement("div");return Object.assign(u.style,{display:"grid",gridTemplateColumns:"1fr auto auto auto",gap:"8px",alignItems:"center",padding:"6px 8px",background:"transparent",borderBottom:"dotted 1px #bcced5"}),u.innerHTML=`\n          <div>\n            <div style="font-weight:600">${s}</div>\n            <div style="font-size:12px;color:#666">çŠ¶æ…‹: ${i||"â€”"} / æ‹…å½“: ${d||"â€”"} / æœŸé™: ${c||"â€”"}</div>\n          </div>\n          <button data-act="start" type="button" title="é€²è¡Œä¸­ã«ã™ã‚‹">é€²è¡Œä¸­</button>\n          <button data-act="done" type="button" title="å®Œäº†ã«ã™ã‚‹">å®Œäº†</button>\n          <a href="${location.origin}/k/23/show#record=${t}" target="_blank">é–‹ã</a>`,u.addEventListener("click",async e=>{const n=e.target.closest("button");if(!n)return;const o="start"===n.dataset.act?"é€²è¡Œä¸­":"å®Œäº†";try{await kintone.api(l("/k/v1/record"),"PUT",{app:23,id:t,record:{[r]:{value:o}}}),w()}catch(e){console.error("[task] æ›´æ–°ã‚¨ãƒ©ãƒ¼",e),alert("ã‚¿ã‚¹ã‚¯æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}),u}async function w(){f.textContent="èª­è¾¼ä¸­â€¦";const e=await v();if(f.innerHTML="",e.length)for(const t of e)f.appendChild(b(t));else f.textContent="å¯¾è±¡ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"}g||(f.innerHTML=`<div style="color:#c00;">æ¡ˆä»¶å´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Œ${e}ã€ãŒç©ºã§ã™ã€‚å€¤ã‚’å…¥ã‚Œã‚‹ã¨ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤ºãƒ»è¿½åŠ ã§ãã¾ã™ã€‚</div>`),await async function(){const e=kintone.getLoginUser();h.innerHTML="";const t=document.createElement("option");t.value=e.code,t.textContent=`${e.name}ï¼ˆè‡ªåˆ†ï¼‰`,h.appendChild(t);try{let t=0,n=100;for(;;){const o=(await kintone.api(l("/v1/users"),"GET",{offset:t,size:n})).users||[];for(const t of o){if(!t.valid||t.code===e.code)continue;const n=document.createElement("option");n.value=t.code,n.textContent=t.name,h.appendChild(n)}if(o.length<n)break;t+=n}h.value=e.code}catch(e){console.warn("[task] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—å¤±æ•—:",e)}}();const x=m.querySelector("#task-add");x.addEventListener("click",async()=>{const s=(m.querySelector("#task-title").value||"").trim(),i=(m.querySelector("#task-due").value||"").trim(),u=m.querySelector("#task-owner").value||kintone.getLoginUser().code;if(!s)return alert("ä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");if(!g)return alert(`æ¡ˆä»¶å´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Œ${e}ã€ãŒç©ºã§ã™ã€‚å€¤ã‚’å…¥ã‚Œã¦ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚`);const p=`${t} = "${d(g)}" and ${n} = "${d(s)}" limit 1`;try{if(((await kintone.api(l("/k/v1/records"),"GET",{app:23,query:p})).records||[]).length)return alert("ã“ã®æ¡ˆä»¶ã«åŒåã®ã‚¿ã‚¹ã‚¯ãŒæ—¢ã«ã‚ã‚Šã¾ã™ã€‚ä»¶åã‚’å¤‰ãˆã¦ãã ã•ã„ã€‚")}catch(e){console.warn("[task] é‡è¤‡ç¢ºèªã«å¤±æ•—ï¼ˆç¶šè¡Œï¼‰:",e)}const f={[t]:{value:g},[n]:{value:s},[o]:{value:i||""},[a]:{value:[{code:u}]},[r]:{value:"æœªç€æ‰‹"},[c]:{value:k||""}};x.disabled=!0;const y=x.textContent;x.textContent="ä½œæˆä¸­â€¦";try{const e=await kintone.api(l("/k/v1/record"),"POST",{app:23,record:f});alert(`ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã—ãŸï¼ˆ#${e.id}ï¼‰ã€‚`),m.querySelector("#task-title").value="",m.querySelector("#task-due").value="";const t=kintone.getLoginUser();t?.code&&(h.value=t.code),await w()}catch(e){console.error("[task] ä½œæˆã‚¨ãƒ©ãƒ¼",e);const t=e?.message||e?.errors&&JSON.stringify(e.errors)||e?.code||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";alert(`ã‚¿ã‚¹ã‚¯ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n${t}`)}finally{x.disabled=!1,x.textContent=y}});const E=m.querySelector("#task-show-list");let S=!1;E.addEventListener("click",()=>{"none"===f.style.display?(f.style.display="flex",E.textContent="ä¸€è¦§ã‚’éš ã™",S||(w(),S=!0)):(f.style.display="none",E.textContent="ã‚¿ã‚¹ã‚¯ä¸€è¦§")});const $=()=>{m.style.display="none",u.dispatchEvent(new CustomEvent("taskPanel:hidden",{bubbles:!1}))};m.querySelector("#task-close").addEventListener("click",$);const T=e=>{"Escape"===e.key&&"none"!==m.style.display&&$()};document.addEventListener("keydown",T),u.addEventListener("taskPanel:hidden",()=>{document.removeEventListener("keydown",T)})}catch(L){console.error("[task] initTaskPanel fatal:",L)}}(u,m)}}()},207:(e,t,n)=>{var o={"./case_summary_sync.js":350,"./comment-reactions.js":569,"./commentPanel-launcher.js":621,"./index.js":241,"./schedule_app.js":480,"./task_app.js":56,"./title_autoset.js":861};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id=207},241:(e,t,n)=>{var o;(o=n(207)).keys().forEach(o)},350:()=>{!function(){"use strict";const e="app_id",t="record_id",n="case_group",o="staff";[22,26,55].includes(kintone.app.getId())&&kintone.events.on(["app.record.create.submit.success","app.record.edit.submit.success"],async a=>{try{const r=a.record,s=kintone.app.getId(),c=a.recordId,i=(r[o]?.value||[]).map(e=>e.name).join(", "),l={[e]:{value:String(s)},[t]:{value:String(c)},[n]:{value:r[n]?.value||""},[o]:{value:i}},d=`${e} = "${s}" and ${t} = "${c}"`,u=await kintone.api(kintone.api.url("/k/v1/records",!0),"GET",{app:58,query:d});if(u.records.length>0){const e=u.records[0].$id.value;await kintone.api(kintone.api.url("/k/v1/record",!0),"PUT",{app:58,id:e,record:l}),console.log(`ğŸŒ€ æ›´æ–°ã—ã¾ã—ãŸï¼ˆID:${e}ï¼‰`)}else await kintone.api(kintone.api.url("/k/v1/record",!0),"POST",{app:58,record:l}),console.log("âœ… æ–°è¦ç™»éŒ²ã—ã¾ã—ãŸ")}catch(e){console.error("âŒ é›†è¨ˆã‚¢ãƒ—ãƒªç™»éŒ²ã‚¨ãƒ©ãƒ¼:",e)}return a})}()},480:()=>{const e="date",t="title",n="description",o="attendees",a="schedulePanel",r="case_id",s="case_type",c="case_id",i="åˆ‘äº‹äº¤é€šä»¥å¤–",l={22:"åˆ‘äº‹äº‹ä»¶",26:"äº¤é€šäº‹æ•…",55:i};!function(){"use strict";const d=e=>kintone.api.url(e.endsWith(".json")?e:`${e}.json`,!0),u=(e="")=>String(e).replace(/\\/g,"\\\\").replace(/"/g,'\\"');function p(){const e=new Date;return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10)}function m(n){const a=n.$id.value,r=n[e]?.value||"â€”",s=n[t]?.value||"(ç„¡é¡Œ)",c=Array.isArray(n[o]?.value)?n[o].value.map(e=>e.name||e.code).join(", "):"â€”",i=document.createElement("div");return Object.assign(i.style,{display:"grid",gridTemplateColumns:"1fr auto",gap:"8px",padding:"6px 8px",alignItems:"center",background:"#fafafa",borderBottom:"dotted 1px #e4e1e1"}),i.innerHTML=`\n      <div>\n        <div style="font-weight:600">${s}</div>\n        <div style="font-size:12px;color:#666">æ—¥ä»˜: ${r} / å‚åŠ : ${c}</div>\n      </div>\n      <a href="${location.origin}/k/45/show#record=${a}" target="_blank">é–‹ã</a>\n    `,i}kintone.events.on(["app.record.detail.show"],async e=>{const t=kintone.app.record.getSpaceElement(a);if(!t)return e;if(!t.dataset.initedSchedulePanel){t.dataset.initedSchedulePanel="1";try{await window.userSchedulePanelInit(t)}catch(e){console.warn("[schedule] auto init failed:",e)}}return e}),window.userSchedulePanelInit=async function(f){const h=kintone.app.record.get(),y=h&&h.record?h.record:{};kintone.app.getId(),h&&h.record&&h.recordId||kintone.app.record.getId(),await async function(f,h){try{if(!(f=function(e){if(e&&1===e.nodeType)return e;const t=document.querySelector('[data-mirror-of="user-js-schedulePanel"]');if(t)return t;const n=kintone.app.record.getSpaceElement(a);if(n)return n;const o=document.querySelector(".ocean-ui-comments-commentform-form");if(o){const e=document.createElement("div");return e.dataset.mirrorOf="user-js-schedulePanel",Object.assign(e.style,{marginTop:"12px",borderTop:"1px dashed #e5e7eb",paddingTop:"12px"}),o.insertAdjacentElement("afterend",e),e}const r=document.querySelector("#record-gaia, .contents-gaia, body"),s=document.createElement("div");return s.dataset.mirrorOf="user-js-schedulePanel",r.appendChild(s),s}(f)))return console.warn("[schedule] mountEl not found");const y=function(){try{const e=kintone.app.getId();if(e)return Number(e)}catch(e){}const e=location.pathname.match(/\/k\/(\d+)\//);return e?Number(e[1]):NaN}(),k=l[y]??i,g=(h?.[c]?.value||"").toString().trim();f.style.display="",f.innerHTML="";const v=document.createElement("div");v.classList.add("k-schedule-panel"),v.style.padding="12px",v.style.background="#f7f9fa",v.style.display="",v.innerHTML='\n      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">\n        <strong>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²</strong>\n        <div style="margin-left:auto; display:flex; gap:6px;">\n          <button id="sch-show-list" type="button">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§</button> \x3c!-- NEW --\x3e\n          <button id="sch-clear" type="button">å…¥åŠ›ã‚¯ãƒªã‚¢</button>\n          <button id="sch-close" type="button" aria-label="é–‰ã˜ã‚‹ï¼ˆEscï¼‰">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n        </div>\n      </div>\n      <style>\n        button { font-size:13px; }\n        .k-schedule-form-left, .k-schedule-form-right { display:flex; flex-direction:column; gap:8px; }\n        .k-schedule-form-wrapper { display:grid; grid-template-columns: 1fr 260px; gap:12px; }\n        .k-schedule-form-wrapper input[type="text"], .k-schedule-form-wrapper input[type="date"],\n        .k-schedule-form-wrapper textarea, .k-schedule-form-wrapper select {\n          border:1px solid #e3e7e8; border-radius:6px; width:100%; padding:8px; box-sizing:border-box;\n        }\n        .k-schedule-form-left textarea { flex-grow:1; resize:vertical; }\n        .k-schedule-actions button, #sch-clear, #sch-close, #sch-show-list {\n          padding:.5rem .75rem; background:#fff; border-radius:6px; border:1px solid #e3e7e8; font-size:.9rem;\n        }\n        .k-schedule-form-wrapper input:focus, .k-schedule-form-wrapper textarea:focus,\n        .k-schedule-form-wrapper select:focus, .k-schedule-actions button:focus,\n        #sch-clear:focus, #sch-close:focus, #sch-show-list:focus {\n          outline:none; box-shadow:0 0 0 3px rgba(227,231,232,.4); border-color:#e3e7e8;\n        }\n        #sch-create { background-color:#3598db; color:#FFF; width:100%; }\n        #sch-create:hover { background-color:#1182ce; }\n        #sch-close, #sch-clear, #sch-show-list { font-size:12px; padding:6px 10px; }\n        #sch-close:hover, #sch-clear:hover, #sch-show-list:hover { background:#f5f7f8; }\n        @media (max-width:600px){ .k-schedule-form-wrapper { grid-template-columns:1fr; } }\n      </style>\n\n      <div id="sch-list" style="display:none; flex-direction:column; gap:6px; margin-bottom:12px;"></div> \x3c!-- NEW --\x3e\n\n      <div class="k-schedule-form-wrapper">\n        <div class="k-schedule-form-left">\n            <label>äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ« <input id="sch-title" type="text" placeholder="ä¾‹ï¼‰æ‰“ã¡åˆã‚ã›"></label>\n            <label style="display:flex; flex-direction:column; flex-grow:1;">äºˆå®šã®èª¬æ˜ <textarea id="sch-desc" placeholder="äºˆå®šã®è©³ç´°ã‚„ãƒ¡ãƒ¢ã‚’å…¥åŠ›"></textarea></label>\n        </div>\n        <div class="k-schedule-form-right">\n            <label>äºˆå®šæ—¥ï¼ˆçµ‚æ—¥ï¼‰ <input id="sch-date" type="date"></label>\n            <label>å‚åŠ è€…ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ <select id="sch-users" multiple size="8"></select></label>\n            <div class="k-schedule-actions">\n              <button id="sch-create" type="button">ï¼‹ äºˆå®šã‚’ç™»éŒ²</button>\n            </div>\n        </div>\n      </div>\n    ',f.appendChild(v);const b=v.querySelector("#sch-list"),w=v.querySelector("#sch-show-list"),x=v.querySelector("#sch-date"),E=v.querySelector("#sch-title"),S=v.querySelector("#sch-desc"),$=v.querySelector("#sch-users");x.value=p(),await async function(e){const t=kintone.getLoginUser();e.innerHTML="";const n=document.createElement("option");n.value=t.code,n.textContent=`${t.name}ï¼ˆè‡ªåˆ†ï¼‰`,n.selected=!0,e.appendChild(n);try{let n=0,o=100;for(;;){const a=(await kintone.api(d("/v1/users"),"GET",{offset:n,size:o})).users||[];for(const n of a){if(!n.valid||n.code===t.code)continue;const o=document.createElement("option");o.value=n.code,o.textContent=n.name,e.appendChild(o)}if(a.length<o)break;n+=o}}catch(e){console.warn("ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—å¤±æ•—:",e)}}($);let T=!1;async function L(){b.textContent="èª­è¾¼ä¸­â€¦";const t=await async function(t,n){try{let o="";if(t){const a=u(t);o=`${r} = "${a}"`,n&&(o+=` and ${s} = "${u(n)}"`),o+=` order by ${e} asc`}else o=`order by ${e} desc limit 50`;return(await kintone.api(d("/k/v1/records.json"),"GET",{app:45,query:o})).records||[]}catch(e){return console.error("[schedule] å–å¾—ã‚¨ãƒ©ãƒ¼:",e),[]}}(g,k);if(b.innerHTML="",t.length)for(const e of t)b.appendChild(m(e));else b.textContent=g?"ã“ã®æ¡ˆä»¶ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚":"äºˆå®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"}w.addEventListener("click",async()=>{"none"===b.style.display?(b.style.display="flex",w.textContent="ä¸€è¦§ã‚’éš ã™",T||(await L(),T=!0)):(b.style.display="none",w.textContent="ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§")}),v.querySelector("#sch-clear").addEventListener("click",()=>{x.value=p(),E.value="",S.value="";const e=kintone.getLoginUser();for(const t of $.options)t.selected=t.value===e.code});const C=v.querySelector("#sch-create");C.addEventListener("click",async()=>{const a=(x.value||"").trim(),i=(E.value||"").trim(),l=(S.value||"").trim(),u=Array.from($.selectedOptions).map(e=>({code:e.value}));if(!a)return alert("äºˆå®šæ—¥ï¼ˆçµ‚æ—¥ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!i)return alert("äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!g)return alert(`æ¡ˆä»¶å´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Œ${c}ã€ãŒç©ºã§ã™ã€‚å€¤ã‚’å…¥ã‚Œã¦ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚`);C.disabled=!0;const p=C.textContent;C.textContent="ç™»éŒ²ä¸­â€¦";try{await async function(e){return kintone.api(d("/k/v1/record"),"POST",{app:45,record:e})}({[e]:{value:a},[t]:{value:i},[n]:{value:l},[o]:{value:u},[r]:{value:g},[s]:{value:k}}),alert("äºˆå®šã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚"),E.value="",S.value="";const c=kintone.getLoginUser();for(const e of $.options)e.selected=e.value===c.code;"none"!==b.style.display&&await L()}catch(e){console.error("äºˆå®šç™»éŒ²ã‚¨ãƒ©ãƒ¼:",e);const t=e?.message||e?.errors&&JSON.stringify(e.errors)||e?.code||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";alert(`äºˆå®šç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n${t}`)}finally{C.disabled=!1,C.textContent=p}});const j=()=>{v.style.display="none",f.dispatchEvent(new CustomEvent("schedulePanel:hidden",{bubbles:!1}))};v.querySelector("#sch-close").addEventListener("click",j);const q=e=>{"Escape"===e.key&&"none"!==v.style.display&&j()};document.addEventListener("keydown",q),f.addEventListener("schedulePanel:hidden",()=>{document.removeEventListener("keydown",q)})}catch(O){console.error("[schedule] initSchedulePanel fatal:",O)}}(f,y)}}()},569:()=>{!function(){"use strict";const e=["ğŸ˜„","ğŸ˜¢","â¤ï¸","ğŸ‘Œ"],t="reaction_log",n={":smile:":"ğŸ˜„",":cry:":"ğŸ˜¢",":heart:":"â¤ï¸",":ok:":"ğŸ‘Œ"},o={};async function a(){Object.keys(o).length||(await kintone.api(kintone.api.url("/v1/users.json",!0),"GET",{})).users.forEach(e=>{const t=`https://${location.hostname}/api/user/photo.do/-/user.png?id=${e.id}&size=NORMAL`;o[e.email]={name:e.name,photoUrl:e.photo&&e.photo.url?e.photo.url:t}})}async function r(e){return Object.keys(o).length||await a(),o[e]?.photoUrl||"https://static.cybozu.com/kintone/v2.0/images/people/no_photo.png"}function s(e){let t=e.innerHTML;for(const[e,o]of Object.entries(n))t=t.replaceAll(e,o);e.innerHTML=t}async function c(t,n,a,s){const c=document.createElement("div");c.className="cw-reaction-wrapper";const i=document.createElement("div");i.className="cw-reaction-users";const l=new Set;for(const e of Object.keys(a[n]||{}))(a[n][e]||[]).forEach(e=>l.add(e));for(const e of l){const t=await r(e),s=document.createElement("div");s.className="cw-user-icon";const c=document.createElement("img");c.src=t,s.appendChild(c);const l=document.createElement("span");l.className="cw-emoji-badge";for(const[t,o]of Object.entries(a[n]||{}))o.includes(e)&&(l.textContent=t);l.textContent&&s.appendChild(l);const d=document.createElement("div");d.className="cw-tooltip",d.textContent=`${o[e]?.name||e}`,s.appendChild(d),i.appendChild(s)}const d=document.createElement("div");d.className="cw-reactions",e.forEach(e=>{const t=a[n]?.[e]||[],o=t.length?`<span>${t.length}</span>`:"",r=t.includes(s)?"active":"",c=document.createElement("button");c.className=`cw-react-btn ${r}`,c.dataset.emoji=e,c.dataset.commentId=n,c.innerHTML=`${e}${o}`,d.appendChild(c)}),c.appendChild(i),c.appendChild(d);const u=t.querySelector(".text11.itemlist-footer-gaia");u&&!u.querySelector(".cw-reaction-wrapper")&&u.appendChild(c)}kintone.events.on("app.record.detail.show",async function(e){const n=e.recordId,o=kintone.getLoginUser().email,r=await async function(e){const n=await kintone.api(kintone.api.url("/k/v1/record",!0),"GET",{app:kintone.app.getId(),id:e});try{return JSON.parse(n.record[t].value||"{}")}catch{return{}}}(n);async function i(){const e=document.querySelectorAll(".itemlist-item-gaia");for(const t of e){const e=t.querySelector(".itemlist-datetime-gaia a"),n=e?.href.match(/comment=(\d+)/)?.[1];if(!n)continue;const a=t.querySelector(".commentlist-body-gaia > div");a&&s(a),await c(t,n,r,o)}}await a(),await i();const l=document.querySelector("#sidebar-list-gaia");if(l){const e=new MutationObserver(async t=>{e.disconnect();let n=!1;for(const e of t){for(const t of e.addedNodes)if(1===t.nodeType&&t.classList.contains("itemlist-item-gaia")){n=!0;break}if(n)break}n&&(console.log("ğŸ†• ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢å¤‰åŒ–æ¤œçŸ¥ â†’ å†æç”»"),await i()),e.observe(l,{childList:!0,subtree:!0})});e.observe(l,{childList:!0,subtree:!0}),console.log("ğŸ‘€ ã‚³ãƒ¡ãƒ³ãƒˆé ˜åŸŸç›£è¦–é–‹å§‹")}document.body.addEventListener("click",async e=>{if(!e.target.classList.contains("cw-react-btn"))return;const a=e.target.dataset.emoji,s=e.target.dataset.commentId;r[s]??={};for(const e of Object.keys(r[s]))r[s][e]=(r[s][e]||[]).filter(e=>e!==o);const i=r[s][a]||=[];i.includes(o)||i.push(o),await async function(e,n){await kintone.api(kintone.api.url("/k/v1/record",!0),"PUT",{app:kintone.app.getId(),id:e,record:{[t]:{value:JSON.stringify(n)}}})}(n,r);const l=e.target.closest(".itemlist-item-gaia"),d=l.querySelector(".cw-reaction-wrapper");d&&d.remove(),await c(l,s,r,o)})})}()},621:()=>{!function(){"use strict";const e=kintone.app.record.getSpaceElement;kintone.app.record.getSpaceElement=function(t){return e.call(this,t)||document.getElementById(t)||null};const t='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#3598db" viewBox="0 0 24 24"><path d="M9 16.17l-3.88-3.88-1.41 1.41L9 19 20.3 7.71l-1.41-1.41z"/></svg>';const n=()=>{(function(){const e=document.querySelector(".ocean-ui-comments-commentform-form");if(!e)return!1;if(document.querySelector("#comment-panel-launcher"))return!0;const n=document.createElement("div");n.id="comment-panel-launcher",Object.assign(n.style,{display:"flex",gap:"13px",alignItems:"center",justifyContent:"flex-end",marginBottom:"8px",userSelect:"none"});const o=document.createElement("style");o.textContent="\n      #comment-panel-launcher .launcher-link { color:#3598db; transition: color .15s ease; }\n      #comment-panel-launcher .launcher-link:hover { color:#217dbb; }\n    ",document.head.appendChild(o);const a=function(e){const t=document.createElement("button");return t.type="button",t.className="launcher-link",t.innerHTML=`${e||""}<span style="margin-left:${e?4:0}px;">ã‚¿ã‚¹ã‚¯è¿½åŠ </span>`,Object.assign(t.style,{fontSize:"13px",lineHeight:"1",fontWeight:"800",color:"#3598db",border:"none",background:"transparent",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",padding:"0"}),t}(t);return n.appendChild(a),e.parentElement.insertBefore(n,e),a.addEventListener("click",()=>{!function(e,t,n,o){const a=document.querySelector(`[data-mirror-of="${t}"]`);if(a){const e=a.querySelector(".k-schedule-panel, .k-task-panel");return e?"none"===e.style.display&&(e.style.display=""):"function"==typeof window[n]?window[n](a):document.dispatchEvent(new CustomEvent(o,{detail:{mountEl:a}})),void a.scrollIntoView({behavior:"smooth",block:"center"})}const r=document.createElement("div");r.dataset.mirrorOf=t,r.style.marginTop="12px",r.style.borderTop="1px dashed #e5e7eb",r.style.paddingTop="12px",e.insertAdjacentElement("afterend",r),"function"==typeof window[n]?window[n](r):document.dispatchEvent(new CustomEvent(o,{detail:{mountEl:r}})),r.scrollIntoView({behavior:"smooth",block:"center"})}(e,"user-js-taskPanel","userTaskPanelInit","user-js-open-task")}),!0})()||setTimeout(n,150)};kintone.events.on("app.record.detail.show",()=>{n()}),function(e){const t=e.pushState,n=e.replaceState;let o=location.href;const a=e=>{e&&e.toString()!==o&&(o=e.toString(),window.dispatchEvent(new CustomEvent("urlchanged",{detail:{url:o}})))};e.pushState=function(n,o,r){const s=t.apply(e,[n,o,r]);return a(r),s},e.replaceState=function(t,o,r){const s=n.apply(e,[t,o,r]);return a(r),s},window.addEventListener("popstate",()=>{a(location.href)})}(window.history),window.addEventListener("urlchanged",e=>{console.log("[Launcher] URL changed detected:",e.detail.url),setTimeout(()=>{console.log("[Launcher] Attempting to re-inject launcher and panels.");const e=document.querySelector("#comment-panel-launcher");e&&(console.log("[Launcher] Removing existing launcher."),e.remove());const t=document.querySelector('[data-mirror-of="user-js-taskPanel"]');t&&(console.log("[Launcher] Removing existing task panel mirror."),t.remove()),n()},200)})}()},861:()=>{!function(){"use strict";const e="staff",t="staff_text",n="case_title",o="title_display";function a(a){const r=a.record||{};if(!r[t]||!r[o])return a;const s=r[t]?(c=r[e]?.value,Array.isArray(c)&&c.length?c.map(e=>e&&e.name).filter(Boolean).join("ãƒ»"):""):"";var c;r[t].value=s;const i=r[n]&&r[n].value||"";return r[o].value=function(e,t){const n=(e||"").trim(),o=(t||"").trim();return o?`${n}ï¼ˆæ‹…å½“ï¼š${o}ï¼‰`:n}(i,s),a}kintone.events.on(["app.record.create.show","app.record.edit.show",`app.record.create.change.${e}`,`app.record.edit.change.${e}`,`app.record.create.change.${n}`,`app.record.edit.change.${n}`],a),kintone.events.on(["app.record.create.submit","app.record.edit.submit"],a)}()}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(241)})();