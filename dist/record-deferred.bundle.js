(()=>{var e={138:(e,t,n)=>{"use strict";n.d(t,{AGGREGATE_APP_ID:()=>a,APP_ID_TO_CASE_TYPE:()=>r,TASK_APP_ID:()=>o});const o=23,r={22:"åˆ‘äº‹äº‹ä»¶",26:"äº¤é€šäº‹æ•…",55:"åˆ‘äº‹äº¤é€šä»¥å¤–"},a=58},155:(e,t,n)=>{"use strict";n.r(t);var o=n(923),r=n(138);const a=Object.keys(r.APP_ID_TO_CASE_TYPE).map(Number),s="app_id",c="record_id",i="case_group",l="staff";if(a.includes(kintone.app.getId())){const e=["app.record.create.submit.success","app.record.edit.submit.success"];kintone.events.on(e,async e=>{try{const t=e.record,n=kintone.app.getId(),a=e.recordId,d=(t[l]?.value||[]).map(e=>e.name).join(", "),u={[s]:{value:String(n)},[c]:{value:String(a)},[i]:{value:t[i]?.value||""},[l]:{value:d}},p=`${s} = "${n}" and ${c} = "${a}"`,m=await kintone.api((0,o.kUrl)("/k/v1/records.json"),"GET",{app:r.AGGREGATE_APP_ID,query:p});if(m.records.length>0){const e=m.records[0].$id.value;await kintone.api((0,o.kUrl)("/k/v1/record.json"),"PUT",{app:r.AGGREGATE_APP_ID,id:e,record:u}),console.log(`ğŸŒ€ æ›´æ–°ã—ã¾ã—ãŸï¼ˆID:${e}ï¼‰`)}else await kintone.api((0,o.kUrl)("/k/v1/record.json"),"POST",{app:r.AGGREGATE_APP_ID,record:u}),console.log("âœ… æ–°è¦ç™»éŒ²ã—ã¾ã—ãŸ")}catch(e){console.error("âŒ é›†è¨ˆã‚¢ãƒ—ãƒªç™»éŒ²ã‚¨ãƒ©ãƒ¼:",e)}return e})}},312:(e,t,n)=>{var o;(o=n(390)).keys().forEach(o)},330:()=>{!function(){"use strict";kintone.events.on("app.record.detail.show",function(e){e.record;let t=!1;return(()=>{const e=document.body;new MutationObserver((e,n)=>{const o=document.querySelector(".ocean-ui-comments-commentform-submit");var r;o&&(n.disconnect(),(r=o).dataset.swalListenerAttached||(r.dataset.swalListenerAttached="true",console.log("setupClickListener: ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†"),r.addEventListener("click",async e=>{if(console.log("setupClickListener: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ¤œçŸ¥"),t)return void console.log("setupClickListener: isPopupProcessingãŒtrueã®ãŸã‚å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—");const n=document.querySelector(".ocean-ui-comments-commentform-textarea");if(!n||!n.value.trim())return void console.log("setupClickListener: ã‚³ãƒ¡ãƒ³ãƒˆãŒç©ºã®ãŸã‚å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—");if(!(()=>{const e=kintone.getLoginUser(),t=kintone.app.record.get().record,n=t.main_lawyer.value.map(e=>e.code),o=t.staff.value.map(e=>e.code),r=t.chief.value.map(e=>e.code);return n.includes(e.code)||o.includes(e.code)||r.includes(e.code)})())return void console.log("setupClickListener: æ‹…å½“è€…ã§ãªã„ãŸã‚å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—");e.preventDefault(),e.stopPropagation(),console.log("setupClickListener: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºæº–å‚™"),await(window.Swal?Promise.resolve():new Promise(e=>{const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/sweetalert2@11",t.onload=e,document.head.appendChild(t)}));let o=document.querySelector(".gaia-app-statusbar-statusmenu")?.innerText.replace(/\n/g,"<br>")||"";o=o.replace(/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å±¥æ­´/g,""),o=o.replace(/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:/g,"ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š"),o=o.replace(/ç¾åœ¨ã®ä½œæ¥­è€…:/g,"ç¾åœ¨ã®ä½œæ¥­è€…ï¼š");const a=document.querySelectorAll(".gaia-app-statusbar-action");let s="";a.forEach((e,t)=>{const n=e.querySelector(".gaia-app-statusbar-action-label");let o=n?.innerText;const r=n?.title;if(o){let e="margin: .5rem; border: 1px solid #e3e7e8; background-color: #f7f9fa; box-shadow: 1px 1px 1px #fff inset; color: #3498db;";"ç¾åœ¨ã®ä½œæ¥­è€…ã‚’å¤‰æ›´"===r?(o="ç¾åœ¨ã®ä½œæ¥­è€…ã‚’å¤‰æ›´",e="margin: .5rem; border: 1px solid #e3e7e8; background-color: #FFF; box-shadow: 1px 1px 1px #fff inset; color: #3498db; border-radius: 22px; border: none;"):"æ¡ˆä»¶çµ‚äº†"===r&&(e="margin: .5rem; border: 1px solid #c0392b; background-color: #ffeeec; color: #c0392b;"),s+=`<button class="swal2-styled" id="swal-action-${t}" style="${e}">${o}</button>`}}),Swal.fire({title:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰æ›´ã¯ä¸è¦ã§ã™ã‹ï¼Ÿ",html:`<div style="text-align: left; padding: 0 1em; margin-bottom: 1em; text-align: center; background-color: #c7c7c745; color: #000000; padding: 1rem; line-height: 2; letter-spacing: 0.05rem; font-size: 1.3rem; border-color: #FFF; border-width: thick;">${o}</div>`+s,footer:'<div style="display: flex; justify-content: center; align-items: center; padding-top: 1rem;">\n            <button class="swal2-styled" id="swal-comment-only" style="background-color: #3598db; color: #FFF;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã¯ä¸è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸ</button>\n            <a href="#" id="swal-cancel-link" style="color: #777; text-decoration: none; margin-left: auto; position: absolute; right: 2rem; bottom: 1.2rem; font-size: .8rem;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>\n          </div>',showCancelButton:!1,showConfirmButton:!1,width:"55%",didOpen:()=>{console.log("Swal.fire: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºå®Œäº†"),a.forEach((e,n)=>{const o=document.getElementById(`swal-action-${n}`);o&&o.addEventListener("click",()=>{console.log(`Swal.fire: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã€Œ${e.querySelector(".gaia-app-statusbar-action-label")?.innerText}ã€ã‚¯ãƒªãƒƒã‚¯`),e.click();const n=new MutationObserver(()=>{console.log("MutationObserver: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºéƒ¨åˆ†ã®DOMå¤‰æ›´ã‚’æ¤œçŸ¥"),n.disconnect(),t=!0,r.click(),console.log("MutationObserver: ã‚³ãƒ¡ãƒ³ãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯"),setTimeout(()=>{t=!1,console.log("setTimeout: isPopupProcessingã‚’falseã«ãƒªã‚»ãƒƒãƒˆ")},100)}),o=document.querySelector(".gaia-app-statusbar-statusmenu");o&&(n.observe(o,{childList:!0,subtree:!0}),console.log("MutationObserver: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºéƒ¨åˆ†ã®ç›£è¦–é–‹å§‹")),Swal.close()})});const e=document.getElementById("swal-comment-only");e&&e.addEventListener("click",()=>{console.log("Swal.fire: ã€Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã¯ä¸è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯"),t=!0,r.click(),setTimeout(()=>{t=!1,console.log("setTimeout: isPopupProcessingã‚’falseã«ãƒªã‚»ãƒƒãƒˆ")},100),Swal.close()});const n=document.getElementById("swal-cancel-link");n&&n.addEventListener("click",e=>{e.preventDefault(),console.log("Swal.fire: ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯"),Swal.close()})}})})))}).observe(e,{childList:!0,subtree:!0})})(),e})}()},390:(e,t,n)=>{var o={"./auto_fill_same_person.js":916,"./case_summary_sync.js":155,"./comment-reactions.js":804,"./commentPanel-launcher.js":920,"./index.js":312,"./linkify_case_number.js":781,"./process_management_popup.js":330,"./save_last_comment_datetime.js":438,"./scroll_to_error.js":898,"./task_app.js":423,"./title_autoset.js":760};function r(e){var t=a(e);return n(t)}function a(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=a,e.exports=r,r.id=390},423:(e,t,n)=>{"use strict";n.r(t);var o=n(923),r=n(138);const a="case_id",s="case_id",c="title",i="due_date",l="assignee",d="task_status",u="taskPanel",p="case_type",m=(e="")=>String(e).replace(/\\/g,"\\\\").replace(/"/g,'\\"');kintone.events.on(["app.record.detail.show"],async e=>{const t=kintone.app.record.getSpaceElement(u);if(!t)return e;if(!t.dataset.initedTaskPanel){t.dataset.initedTaskPanel="1";try{await window.userTaskPanelInit(t)}catch(e){console.warn("[task] auto init failed:",e)}}return e}),window.userTaskPanelInit=async function(e,t){const n=kintone.app.record.get(),f=n&&n.record?n.record:{};kintone.app.getId(),n&&n.record&&n.recordId||kintone.app.record.getId(),await async function(e,t,n,f,g){try{if(!(e=function(e){if(e&&1===e.nodeType)return e;const t=document.querySelector('[data-mirror-of="user-js-taskPanel"]');if(t)return t;const n=kintone.app.record.getSpaceElement(u);if(n)return n;const o=document.querySelector(".ocean-ui-comments-commentform-form");if(o){const e=document.createElement("div");return e.dataset.mirrorOf="user-js-taskPanel",Object.assign(e.style,{marginTop:"12px",borderTop:"1px dashed #e5e7eb",paddingTop:"12px"}),o.insertAdjacentElement("afterend",e),e}const r=document.querySelector("#record-gaia, .contents-gaia, body"),a=document.createElement("div");return a.dataset.mirrorOf="user-js-taskPanel",r.appendChild(a),a}(e)))return console.warn("[task] mountEl not found");e.style.display="",e.innerHTML="";const k=document.createElement("div");if(k.classList.add("k-task-panel"),Object.assign(k.style,{padding:"16px",backgroundColor:"#d6eaf8",color:"#333333",border:"1px solid #D1ECF1",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",marginBottom:"1rem",display:""}),k.innerHTML='\n      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">\n        <strong>ã‚¿ã‚¹ã‚¯è¿½åŠ </strong>\n        <div style="margin-left:auto; display:flex; gap:6px;">\n          <button id="task-show-list" type="button">ã‚¿ã‚¹ã‚¯ä¸€è¦§</button>\n          <button id="task-close" type="button" aria-label="é–‰ã˜ã‚‹ï¼ˆEscï¼‰">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n        </div>\n      </div>\n      <style>\n        .k-task-panel input, .k-task-panel textarea, .k-task-panel select {\n          border: 1px solid #e3e7e8; border-radius: 6px; color: #000;\n        }\n        .k-task-panel input:focus, .k-task-panel textarea:focus, .k-task-panel select:focus, .k-task-panel button:focus {\n          outline: none; box-shadow: 0 0 0 3px rgba(227,231,232,.4); border-color: #e3e7e8;\n        }\n        #task-show-list, #task-close { border: 1px solid #e3e7e8; background:#fff; padding: 6px 10px; border-radius: 6px; font-size: 12px; color: #333; }\n        #task-show-list:hover, #task-close:hover { background: #f5f7f8; }\n        .task-add-row{ display:grid; grid-template-columns: 1fr 260px; gap:12px; align-items:stretch; margin-top:8px; }\n        .task-add-left textarea{ width:100%; height:100%; min-height:120px; resize:vertical; padding:10px; box-sizing:border-box; }\n        .task-add-right{ display:flex; flex-direction:column; gap:8px; }\n        .task-add-right > *{ width:100%; box-sizing:border-box; }\n        .task-add-right button{ height:36px; background:#3598DB; color:#fff; border-radius: 6px;font-size: .9rem; border: none;} /* ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰²ã‚’æ¨™æº–Kintoneãƒ–ãƒ«ãƒ¼ã« */\n        .task-add-right button:hover{ background:#5DADE2;} /* ãƒ›ãƒãƒ¼è‰²ã‚‚èª¿æ•´ */\n        @media (max-width: 640px){ .task-add-row{ grid-template-columns: 1fr; } }\n        .k-task-panel .task-add-right .task-owner, .k-task-panel .task-add-right .task-due{ padding:8px 4px; min-height:36px; box-sizing:border-box; }\n      </style>\n\n      <div id="task-list" style="display:none; flex-direction:column; gap:6px; margin-bottom:12px;"></div>\n      <div class="task-add-row">\n        <div class="task-add-left">\n          <textarea id="task-title" placeholder="ä»¶åã‚’å…¥åŠ›" rows="4"></textarea>\n        </div>\n        <div class="task-add-right">\n          <select id="task-owner" class="task-owner">\n            <option value="" disabled selected>æ‹…å½“è€…ã‚’é¸æŠ</option>\n          </select>\n          <input id="task-due" type="date" class="task-due">\n          <button id="task-add" type="button">ï¼‹ ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>\n        </div>\n      </div>\n      ',e.appendChild(k),g&&g.comment){const O=k.querySelector("#task-title");if(O){const N=O.value,D=N?`${N}\n${g.comment}`:g.comment;O.value=D}}const v=k.querySelector("#task-list"),b=k.querySelector("#task-owner"),y=k.querySelector("#task-due"),h=new Date,w=h.getFullYear(),x=String(h.getMonth()+1).padStart(2,"0"),_=String(h.getDate()).padStart(2,"0");y.value=`${w}-${x}-${_}`;const S=function(){try{const e=kintone.app.getId();if(e)return Number(e)}catch(e){}const e=location.pathname.match(/\/k\/(\d+)\//);return e?Number(e[1]):NaN}(),E=r.APP_ID_TO_CASE_TYPE[S]||"",T=(t?.[a]?.value||"").trim();async function $(){if(!T)return[];const e=m(T),t=E?` and ${p} = "${m(E)}"`:"",n=`${s} = "${e}"${t} order by ${i} asc`;try{const e=await kintone.api((0,o.kUrl)("/k/v1/records.json"),"GET",{app:r.TASK_APP_ID,query:n});if(0===(e.records||[]).length&&/^[0-9]+$/.test(T)){const e=`${s} = ${T}${t} order by ${i} asc`;return(await kintone.api((0,o.kUrl)("/k/v1/records.json"),"GET",{app:r.TASK_APP_ID,query:e})).records||[]}return e.records||[]}catch(e){return console.error("[task] ã‚¿ã‚¹ã‚¯å–å¾—ã‚¨ãƒ©ãƒ¼",e),v.innerHTML=`<div style="color:#c00;">ã‚¿ã‚¹ã‚¯å–å¾—ã§ã‚¨ãƒ©ãƒ¼ï¼š${e?.message||JSON.stringify(e)}</div>`,[]}}function P(e){const t=e.$id.value,n=e[c]?.value||"(ç„¡é¡Œ)",a=e[i]?.value||"",s=e[d]?.value||"",u=Array.isArray(e[l]?.value)?e[l].value.map(e=>e.name||e.code).join(", "):"",p=document.createElement("div");return Object.assign(p.style,{display:"grid",gridTemplateColumns:"1fr auto auto auto",gap:"8px",alignItems:"center",padding:"6px 8px",background:"transparent",borderBottom:"dotted 1px #8fbed0"}),p.innerHTML=`\n        <div>\n          <div style="font-weight:600">${n}</div>\n          <div style="font-size:12px;color:#666">çŠ¶æ…‹: ${s||"â€”"} / æ‹…å½“: ${u||"â€”"} / æœŸé™: ${a||"â€”"}</div>\n        </div>\n        <button data-act="start" type="button" title="é€²è¡Œä¸­ã«ã™ã‚‹">é€²è¡Œä¸­</button>\n        <button data-act="done" type="button" title="å®Œäº†ã«ã™ã‚‹">å®Œäº†</button>\n        <a href="${location.origin}/k/${r.TASK_APP_ID}/show#record=${t}" target="_blank">é–‹ã</a>`,p.addEventListener("click",async e=>{const n=e.target.closest("button");if(!n)return;const a="start"===n.dataset.act?"é€²è¡Œä¸­":"å®Œäº†";try{await kintone.api((0,o.kUrl)("/k/v1/record"),"PUT",{app:r.TASK_APP_ID,id:t,record:{[d]:{value:a}}}),L()}catch(e){console.error("[task] æ›´æ–°ã‚¨ãƒ©ãƒ¼",e),alert("ã‚¿ã‚¹ã‚¯æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}),p}async function L(){v.textContent="èª­è¾¼ä¸­â€¦";const e=await $();if(v.innerHTML="",e.length)for(const t of e)v.appendChild(P(t));else v.textContent="å¯¾è±¡ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"}T||(v.innerHTML=`<div style="color:#c00;">æ¡ˆä»¶å´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Œ${a}ã€ãŒç©ºã§ã™ã€‚å€¤ã‚’å…¥ã‚Œã‚‹ã¨ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤ºãƒ»è¿½åŠ ã§ãã¾ã™ã€‚</div>`),await async function(){const e=kintone.getLoginUser();b.innerHTML="";const t=document.createElement("option");t.value=e.code,t.textContent=`${e.name}ï¼ˆè‡ªåˆ†ï¼‰`,b.appendChild(t);try{let t=0,n=100;for(;;){const r=(await kintone.api((0,o.kUrl)("/v1/users"),"GET",{offset:t,size:n})).users||[];for(const t of r){if(!t.valid||t.code===e.code)continue;const n=document.createElement("option");n.value=t.code,n.textContent=t.name,b.appendChild(n)}if(r.length<n)break;t+=n}b.value=e.code}catch(e){console.warn("[task] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—å¤±æ•—:",e)}}();const C=k.querySelector("#task-add");C.addEventListener("click",async()=>{const e=(k.querySelector("#task-title").value||"").trim(),t=(k.querySelector("#task-due").value||"").trim(),n=k.querySelector("#task-owner").value||kintone.getLoginUser().code;if(!e)return alert("ä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");if(!t)return alert("æœŸé™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");if(!T)return alert(`æ¡ˆä»¶å´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€Œ${a}ã€ãŒç©ºã§ã™ã€‚å€¤ã‚’å…¥ã‚Œã¦ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚`);const u=`${s} = "${m(T)}" and ${c} = "${m(e)}" limit 1`;try{if(((await kintone.api((0,o.kUrl)("/k/v1/records"),"GET",{app:r.TASK_APP_ID,query:u})).records||[]).length)return alert("ã“ã®æ¡ˆä»¶ã«åŒåã®ã‚¿ã‚¹ã‚¯ãŒæ—¢ã«ã‚ã‚Šã¾ã™ã€‚ä»¶åã‚’å¤‰ãˆã¦ãã ã•ã„ã€‚")}catch(e){console.warn("[task] é‡è¤‡ç¢ºèªã«å¤±æ•—ï¼ˆç¶šè¡Œï¼‰:",e)}const f={[s]:{value:T},[c]:{value:e},[i]:{value:t||""},[l]:{value:[{code:n}]},[d]:{value:"æœªç€æ‰‹"},[p]:{value:E||""}};C.disabled=!0;const g=C.textContent;C.textContent="ä½œæˆä¸­â€¦";try{const e=await kintone.api((0,o.kUrl)("/k/v1/record"),"POST",{app:r.TASK_APP_ID,record:f});alert(`ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã—ãŸï¼ˆ#${e.id}ï¼‰ã€‚`),k.querySelector("#task-title").value="",k.querySelector("#task-due").value="";const t=kintone.getLoginUser();t?.code&&(b.value=t.code),await L()}catch(e){console.error("[task] ä½œæˆã‚¨ãƒ©ãƒ¼",e);const t=e?.message||e?.errors&&JSON.stringify(e.errors)||e?.code||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";alert(`ã‚¿ã‚¹ã‚¯ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n${t}`)}finally{C.disabled=!1,C.textContent=g}});const A=k.querySelector("#task-show-list");let j=!1;A.addEventListener("click",()=>{"none"===v.style.display?(v.style.display="flex",A.textContent="ä¸€è¦§ã‚’éš ã™",j||(L(),j=!0)):(v.style.display="none",A.textContent="ã‚¿ã‚¹ã‚¯ä¸€è¦§")});const q=()=>{k.style.display="none",e.dispatchEvent(new CustomEvent("taskPanel:hidden",{bubbles:!1}))};k.querySelector("#task-close").addEventListener("click",q);const I=e=>{"Escape"===e.key&&"none"!==k.style.display&&q()};document.addEventListener("keydown",I),e.addEventListener("taskPanel:hidden",()=>{document.removeEventListener("keydown",I)})}catch(M){console.error("[task] initTaskPanel fatal:",M)}}(e,f,0,0,t)}},438:(e,t,n)=>{"use strict";n.r(t);var o=n(923);const r="last_comment_datetime";function a(e=0){const t=kintone.app.record.getId();if(!t)return;const n=document.querySelector("#sidebar-list-gaia");if(!n)return void(e<10?setTimeout(()=>a(e+1),300):console.warn(`[${r}] Comment area not found after retries.`));if("true"===n.dataset.lastCommentObserverAttached)return;n.dataset.lastCommentObserverAttached="true";const s=new MutationObserver(e=>{let n=!1;for(const t of e){if("childList"===t.type&&t.addedNodes.length>0)for(const e of t.addedNodes)if(1===e.nodeType&&e.classList.contains("itemlist-item-gaia")){n=!0;break}if(n)break}n&&(console.log(`[${r}] New comment detected. Fetching latest comment from API...`),async function(e){try{const t=await kintone.api((0,o.kUrl)("/k/v1/record/comments.json"),"GET",{app:kintone.app.getId(),record:e,order:"desc",limit:1});if(!t.comments||0===t.comments.length)return void console.warn(`[${r}] No comments found for Record ID: ${e}.`);const n=t.comments[0].createdAt;await kintone.api((0,o.kUrl)("/k/v1/record.json"),"PUT",{app:kintone.app.getId(),id:e,record:{[r]:{value:n}}}),console.log(`[${r}] Updated to: ${n} (Record ID: ${e})`)}catch(t){console.error(`[${r}] Failed to update last comment datetime for Record ID: ${e}`,t)}}(t))});s.observe(n,{childList:!0,subtree:!0}),console.log(`[${r}] Watching for new comments to update last comment datetime for Record ID: ${t}.`)}kintone.events.on("app.record.detail.show",a),window.addEventListener("urlchanged",()=>{const e=document.querySelector("#sidebar-list-gaia");e&&delete e.dataset.lastCommentObserverAttached,setTimeout(a,500)})},760:()=>{!function(){"use strict";const e="staff",t="staff_text",n="case_title",o="title_display";function r(r){const a=r.record||{};if(!a[t]||!a[o])return r;const s=a[t]?(c=a[e]?.value,Array.isArray(c)&&c.length?c.map(e=>e&&e.name).filter(Boolean).join("ãƒ»"):""):"";var c;a[t].value=s;const i=a[n]&&a[n].value||"";return a[o].value=function(e,t){const n=(e||"").trim(),o=(t||"").trim();return o?`${n}ï¼ˆæ‹…å½“ï¼š${o}ï¼‰`:n}(i,s),r}kintone.events.on(["app.record.create.show","app.record.edit.show",`app.record.create.change.${e}`,`app.record.edit.change.${e}`,`app.record.create.change.${n}`,`app.record.edit.change.${n}`],r),kintone.events.on(["app.record.create.submit","app.record.edit.submit"],r)}()},781:()=>{!function(){"use strict";kintone.events.on("app.record.index.show",function(e){const t=e.records;if(!t||0===t.length)return e;const n=kintone.app.getFieldElements("case_number");return n&&0!==n.length?(t.forEach((e,t)=>{const o=e.case_number?.value,r=e.sflink?.value;if(!o||!r)return;const a=n[t];if(!a)return;const s=a.querySelector("div");if(!s)return;s.innerHTML="";const c=document.createElement("a");c.href=r,c.textContent=o,c.target="_blank",c.style.color="#3598db",c.style.zIndex="2",c.style.position="relative",s.appendChild(c)}),e):e})}()},804:(e,t,n)=>{"use strict";n.r(t);var o=n(923);const r=["ğŸ˜„","ğŸ˜¢","â¤ï¸","ğŸ‘Œ"],a="reaction_log",s={":smile:":"ğŸ˜„",":cry:":"ğŸ˜¢",":heart:":"â¤ï¸",":ok:":"ğŸ‘Œ"},c={};async function i(e){return(await kintone.api((0,o.kUrl)("/k/v1/record.json"),"GET",{app:kintone.app.getId(),id:e})).record}async function l(e,t,n){await kintone.api((0,o.kUrl)("/k/v1/record.json"),"PUT",{app:kintone.app.getId(),id:e,record:{[a]:{value:JSON.stringify(t)}},revision:n})}async function d(){Object.keys(c).length||(await kintone.api((0,o.kUrl)("/v1/users.json"),"GET",{})).users.forEach(e=>{const t=`https://${location.hostname}/api/user/photo.do/-/user.png?id=${e.id}&size=NORMAL`;c[e.email]={name:e.name,photoUrl:e.photo&&e.photo.url?e.photo.url:t}})}async function u(e){return Object.keys(c).length||await d(),c[e]?.photoUrl||"https://static.cybozu.com/kintone/v2.0/images/people/no_photo.png"}function p(e){let t=e.innerHTML;for(const[e,n]of Object.entries(s))t=t.replaceAll(e,n);e.innerHTML=t}async function m(e,t,n,o){const a=document.createElement("div");a.className="cw-reaction-wrapper";const s=document.createElement("div");s.className="cw-reaction-users";const i=new Set;for(const e of Object.keys(n[t]||{}))(n[t][e]||[]).forEach(e=>i.add(e));for(const e of i){const o=await u(e),r=document.createElement("div");r.className="cw-user-icon";const a=document.createElement("img");a.src=o,r.appendChild(a);const i=document.createElement("span");i.className="cw-emoji-badge";for(const[o,r]of Object.entries(n[t]||{}))r.includes(e)&&(i.textContent=o);i.textContent&&r.appendChild(i);const l=document.createElement("div");l.className="cw-tooltip",l.textContent=`${c[e]?.name||e}`,r.appendChild(l),s.appendChild(r)}const l=document.createElement("div");l.className="cw-reactions",r.forEach(e=>{const r=n[t]?.[e]||[],a=r.length?`<span>${r.length}</span>`:"",s=r.includes(o)?"active":"",c=document.createElement("button");c.className=`cw-react-btn ${s}`,c.dataset.emoji=e,c.dataset.commentId=t,c.innerHTML=`${e}${a}`,l.appendChild(c)});const d=document.createElement("button");d.className="cw-add-task-btn",d.textContent="ï¼‹ã‚¿ã‚¹ã‚¯è¿½åŠ ",Object.assign(d.style,{fontSize:"11px",marginLeft:"8px",padding:"2px 8px",color:"#333",background:"#f7f7f7",border:"1px solid #e3e3e3",borderRadius:"4px",cursor:"pointer"}),d.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=document.querySelector(".ocean-ui-comments-commentform");t&&t.scrollIntoView({behavior:"smooth",block:"center"});const n=e.target.closest(".itemlist-item-gaia");console.log("ã€ãƒ‡ãƒãƒƒã‚°ã€‘1. commentElem (ã‚³ãƒ¡ãƒ³ãƒˆå…¨ä½“):",n);const o=n.querySelector(".commentlist-body-gaia");let r="";if(o){const e=o.querySelectorAll(":scope > div");r=e.length>0?Array.from(e).map(e=>"<br>"===e.innerHTML.trim().toLowerCase()?"":e.textContent||"").join("\n").trim():(o.textContent||"").trim()}console.log("ã€ã‚¿ã‚¹ã‚¯è¿½åŠ ã€‘å–å¾—ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆ:",r),window.userTaskPanelInit&&window.userTaskPanelInit(null,{comment:r})}),l.appendChild(d);const p=document.createElement("button");p.className="cw-quote-btn",p.textContent="å¼•ç”¨",Object.assign(p.style,{fontSize:"11px",marginLeft:"4px",padding:"2px 8px",color:"#333",background:"#f7f7f7",border:"1px solid #e3e3e3",borderRadius:"4px",cursor:"pointer"}),l.appendChild(p),a.appendChild(s),a.appendChild(l);const m=e.querySelector(".text11.itemlist-footer-gaia");m&&!m.querySelector(".cw-reaction-wrapper")&&m.appendChild(a)}kintone.events.on("app.record.detail.show",async function(e){const t=e.recordId,n=kintone.getLoginUser().email,o=await i(t),r=JSON.parse(o[a].value||"{}");async function s(e){const t=document.querySelectorAll(".itemlist-item-gaia");for(const o of t){const t=o.querySelector(".itemlist-datetime-gaia a"),r=t?.href.match(/comment=(\d+)/)?.[1];if(!r)continue;const a=o.querySelector(".commentlist-body-gaia > div");a&&p(a),await m(o,r,e,n)}}await d(),await s(r);const c=document.querySelector("#sidebar-list-gaia");if(c){const e=new MutationObserver(async n=>{e.disconnect();let o=!1;for(const e of n){for(const t of e.addedNodes)if(1===t.nodeType&&t.classList.contains("itemlist-item-gaia")){o=!0;break}if(o)break}if(o){console.log("ğŸ†• ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢å¤‰åŒ–æ¤œçŸ¥ â†’ å†æç”»");const e=await i(t),n=JSON.parse(e[a].value||"{}");await s(n)}e.observe(c,{childList:!0,subtree:!0})});e.observe(c,{childList:!0,subtree:!0}),console.log("ğŸ‘€ ã‚³ãƒ¡ãƒ³ãƒˆé ˜åŸŸç›£è¦–é–‹å§‹")}document.body.dataset.reactionHandlerAttached||(document.body.dataset.reactionHandlerAttached="true",document.body.addEventListener("click",async e=>{if(!e.target.classList.contains("cw-react-btn"))return;const t=kintone.app.record.getId(),n=kintone.getLoginUser().email,o=e.target.dataset.emoji,r=e.target.dataset.commentId;for(let s=0;s<5;s++)try{const s=await i(t),c=JSON.parse(s[a].value||"{}"),d=s.$revision.value,u=JSON.parse(JSON.stringify(c));u[r]=u[r]||{};const p=Object.entries(u[r]).find(([,e])=>Array.isArray(e)&&e.includes(n)),f=p?p[0]:null;if(f===o)u[r][o]=(u[r][o]||[]).filter(e=>e!==n),0===u[r][o].length&&delete u[r][o];else{f&&(u[r][f]=(u[r][f]||[]).filter(e=>e!==n),u[r][f].length||delete u[r][f]);const e=u[r][o]||[];e.includes(n)||e.push(n),u[r][o]=e}await l(t,u,d);const g=e.target.closest(".itemlist-item-gaia");if(g){const e=g.querySelector(".cw-reaction-wrapper");e&&e.remove(),await m(g,r,u,n)}return}catch(e){if(!("CB_VA01"===e.code&&s<4))return console.error("Failed to save reaction:",e),void alert("ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");console.warn(`Reaction conflict detected. Retrying... (${s+1}/5)`),await new Promise(e=>setTimeout(e,100+200*Math.random()))}})),document.body.dataset.quoteHandlerAttached||(document.body.dataset.quoteHandlerAttached="true",document.body.addEventListener("click",e=>{if(!e.target.classList.contains("cw-quote-btn"))return;e.preventDefault(),e.stopPropagation();const t=document.querySelector(".ocean-ui-comments-commentform");t&&t.scrollIntoView({behavior:"smooth",block:"center"});const n=e.target.closest(".itemlist-item-gaia");console.log("ã€ãƒ‡ãƒãƒƒã‚°ã€‘1. commentElem (ã‚³ãƒ¡ãƒ³ãƒˆå…¨ä½“):",n);const o=n.querySelector(".commentlist-body-gaia");let r="";if(o){const e=o.querySelectorAll(":scope > div");r=e.length>0?Array.from(e).map(e=>"<br>"===e.innerHTML.trim().toLowerCase()?"":e.textContent||"").join("\n").trim():(o.textContent||"").trim()}if(console.log("ã€å¼•ç”¨ã€‘å–å¾—ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆ:",r),!r)return;const a=document.querySelector(".ocean-ui-editor-field.editable");if(a){const e=`<blockquote>${r.replace(/\n/g,"<br>")}</blockquote>`;a.focus(),document.execCommand("insertHTML",!1,e)}else{const e=`> ${r.split("\n").join("\n> ")}\n\n`,t=document.querySelector(".ocean-ui-comments-commentform-textarea");if(t){const n=t.selectionStart,o=t.selectionEnd;t.value=t.value.substring(0,n)+e+t.value.substring(o),t.selectionStart=t.selectionEnd=n+e.length,t.focus()}}}))})},898:()=>{!function(){"use strict";console.log("[scroll_to_error] ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚"),kintone.events.on(["app.record.create.show","app.record.edit.show"],function(e){return location.pathname.includes("/edit")?(new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length>0&&e.addedNodes.forEach(function(e){if(1===e.nodeType&&(e.matches(".notifier-header-cybozu")?e:e.querySelector(".notifier-header-cybozu"))){const e=document.querySelector(".input-error-cybozu");if(e){const t=e.closest(".control-value-gaia")||e.closest(".control-gaia");t?t.scrollIntoView({behavior:"smooth",block:"center"}):console.warn("[scroll_to_error] ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¦ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚",e)}else console.warn("[scroll_to_error] ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã¯è¡¨ç¤ºã•ã‚ŒãŸãŒã€.input-error-cybozu ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")}})})}).observe(document.body,{childList:!0,subtree:!0}),e):e})}()},916:()=>{!function(){"use strict";kintone.events.on(["app.record.create.change.same_person","app.record.edit.change.same_person"],function(e){const t=e.record;return t.same_person.value.includes("ã¯ã„")?(t.contractor_name.value=t.suspect_name.value,t.contractor_name_kana.value=t.suspect_name_kana.value):t.contractor_name.value===t.suspect_name.value&&t.contractor_name_kana.value===t.suspect_name_kana.value&&(t.contractor_name.value="",t.contractor_name_kana.value=""),e}),kintone.events.on(["app.record.create.change.suspect_name","app.record.create.change.suspect_name_kana","app.record.edit.change.suspect_name","app.record.edit.change.suspect_name_kana"],function(e){const t=e.record;return t.same_person.value.includes("ã¯ã„")&&(t.contractor_name.value=t.suspect_name.value,t.contractor_name_kana.value=t.suspect_name_kana.value),e})}()},920:()=>{!function(){"use strict";const e=kintone.app.record.getSpaceElement;kintone.app.record.getSpaceElement=function(t){return e.call(this,t)||document.getElementById(t)||null};const t=()=>{(function(){const e=document.querySelector(".ocean-ui-comments-commentform-form");if(!e)return!1;const t="comment-task-launcher";if(document.getElementById(t))return!0;const n=function(e,t){const n=document.createElement("button");return n.id=t,n.type="button",n.className="ocean-ui-comments-commentform-cancel",n.style.marginLeft="2rem",n.style.marginTop="1rem",n.style.float="right",n.innerHTML="ï¼‹ <span>ã‚¿ã‚¹ã‚¯è¿½åŠ </span>",n}(0,t);e.appendChild(n),n.addEventListener("click",t=>{t.preventDefault();let n="";const o=e.querySelector(".ocean-ui-editor-v3");if(o)n=o.textContent||"";else{const t=e.querySelector(".ocean-ui-editor-field.editable");if(t)n=t.innerText;else{const t=e.querySelector(".ocean-ui-comments-commentform-textarea");t&&(n=t.value)}}!function(e,t,n,o,r){let a=document.querySelector(`[data-mirror-of="${t}"]`);const s={comment:r};a||(a=document.createElement("div"),a.dataset.mirrorOf=t,a.style.marginTop="12px",a.style.borderTop="1px dashed #e5e7eb",a.style.paddingTop="12px",e.insertAdjacentElement("afterend",a)),s.mountEl=a,"function"==typeof window[n]?window[n](s.mountEl,{comment:s.comment}):document.dispatchEvent(new CustomEvent("user-js-open-task",{detail:s})),a.scrollIntoView({behavior:"smooth",block:"center"})}(e,"user-js-taskPanel","userTaskPanelInit",0,n)});const o=document.querySelector(".ocean-ui-comments-commentarea");return!o||(new MutationObserver(e=>{for(const t of e)"attributes"===t.type&&"class"===t.attributeName&&(t.target.classList.contains("ocean-ui-comments-commentform-open")?n.style.visibility="visible":n.style.visibility="hidden")}).observe(o,{attributes:!0,attributeFilter:["class"],subtree:!1}),o.classList.contains("ocean-ui-comments-commentform-open")&&(n.style.visibility="visible"),!0)})()||setTimeout(t,150)};kintone.events.on("app.record.detail.show",()=>{t()}),function(e){const t=e.pushState,n=e.replaceState;let o=location.href;const r=e=>{e&&e.toString()!==o&&(o=e.toString(),window.dispatchEvent(new CustomEvent("urlchanged",{detail:{url:o}})))};e.pushState=function(n,o,a){const s=t.apply(e,[n,o,a]);return r(a),s},e.replaceState=function(t,o,a){const s=n.apply(e,[t,o,a]);return r(a),s},window.addEventListener("popstate",()=>{r(location.href)})}(window.history),window.addEventListener("urlchanged",e=>{setTimeout(()=>{const e=document.getElementById("comment-task-launcher");e&&e.remove();const n=document.querySelector('[data-mirror-of="user-js-taskPanel"]');n&&n.remove(),t()},200)})}()},923:(e,t,n)=>{"use strict";n.d(t,{kUrl:()=>o});const o=e=>kintone.api.url(e.endsWith(".json")?e:`${e}.json`,!0)}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(312)})();